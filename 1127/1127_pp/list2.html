<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>Modern ToDo App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Ìè∞Ìä∏ -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />

    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family: "Poppins", sans-serif;
        background: #f5f7fb;
        color: #333;
      }

      .page {
        width: 100%;
        min-height: 100vh;
        padding: 32px 16px 40px;
        display: none;
      }
      .page.active {
        display: block;
        animation: slide 0.3s ease;
      }
      @keyframes slide {
        from {
          opacity: 0;
          transform: translateX(20px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
      }

      /* ÏÉÅÎã® Î∞î - Ï†úÎ™© + ÌîÑÎ°úÌïÑ */
      .top-bar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 20px;
      }
      .title {
        font-size: 28px;
        font-weight: 700;
        color: #2e6eff;
      }

      .profile {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .profile-name {
        font-size: 14px;
        color: #5b647a;
        cursor: pointer;
      }
      .profile-name:hover {
        opacity: 0.8;
      }
      .profile-img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        overflow: hidden;
        border: 2px solid #dbe3ff;
        cursor: pointer;
      }
      .profile-img img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      /* ÌîåÎ°úÌåÖ ÌéòÏù¥ÏßÄ Ïù¥Îèô Î≤ÑÌäº */
      .page-arrow {
        position: fixed;
        right: 16px;
        bottom: 16px;
        width: 44px;
        height: 44px;
        border-radius: 50%;
        background: #2e6eff;
        border: none;
        color: white;
        font-size: 22px;
        cursor: pointer;
        box-shadow: 0 6px 20px rgba(46, 139, 255, 0.4);
      }

      /* Ï£ºÍ∞Ñ Ï∫òÎ¶∞Îçî */
      .week-wrapper {
        background: white;
        border-radius: 16px;
        padding: 8px 12px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
        margin-bottom: 16px;
      }
      .week-label {
        font-size: 13px;
        color: #5a6683;
      }
      .week-days {
        display: flex;
        gap: 6px;
      }
      .week-day {
        width: 34px;
        height: 46px;
        border-radius: 999px;
        background: #f3f5ff;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        font-size: 11px;
        color: #7a849a;
        position: relative;
      }
      .week-day span.date {
        font-size: 13px;
        font-weight: 600;
        color: #4b5687;
      }
      .week-day.today {
        background: #2e6eff;
        color: white;
      }
      .week-day.today span.date {
        color: white;
      }
      .week-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: #2e6eff;
        position: absolute;
        bottom: 6px;
      }

      /* ÏûÖÎ†• Ïπ¥Îìú */
      .todo-input-card {
        background: white;
        border-radius: 18px;
        padding: 18px 18px 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);
        margin-bottom: 18px;
      }
      .todo-row {
        display: flex;
        gap: 10px;
      }
      #todo-input {
        flex: 1;
        padding: 11px 14px;
        border-radius: 12px;
        border: 1px solid #d8def0;
        font-size: 14px;
      }
      .btn-primary {
        padding: 11px 16px;
        border-radius: 12px;
        border: none;
        background: #2e6eff;
        color: white;
        font-weight: 600;
        cursor: pointer;
        font-size: 14px;
      }

      /* ÌïÑÌÑ∞ Î≤ÑÌäº */
      .filter-row {
        display: flex;
        gap: 8px;
        margin-top: 12px;
      }
      .filter-btn {
        padding: 6px 12px;
        border-radius: 999px;
        border: none;
        background: #e6edff;
        color: #3c569f;
        cursor: pointer;
        font-size: 12px;
      }
      .filter-btn.active {
        background: #2e6eff;
        color: white;
        font-weight: 600;
      }

      /* Ìà¨Îëê Î¶¨Ïä§Ìä∏ */
      #todo-list {
        list-style: none;
        margin-top: 16px;
      }
      .todo-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: white;
        margin-bottom: 10px;
        padding: 10px 12px;
        border-radius: 14px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);
        cursor: grab;
      }
      .todo-item.completed {
        opacity: 0.75;
      }

      /* ÌïòÏù¥ÎùºÏù¥Ìä∏ Ìö®Í≥º */
      .highlight {
        animation: highlight 0.6s ease;
      }
      @keyframes highlight {
        0% {
          background: #fff8c6;
        }
        100% {
          background: white;
        }
      }

      .drag-over {
        outline: 2px dashed #2e6eff;
      }

      .check {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        border: 2px solid #2e6eff;
        cursor: pointer;
        flex-shrink: 0;
      }
      .todo-item.completed .check {
        background: #2e6eff;
      }
      .todo-item.completed .check::after {
        content: "‚úì";
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 12px;
        color: white;
        margin-top: -2px;
      }

      .todo-text {
        flex: 1;
        margin-left: 8px;
        font-size: 14px;
      }
      .todo-item.completed .todo-text {
        text-decoration: line-through;
        color: #9aa4b5;
      }

      .actions {
        display: flex;
        gap: 6px;
        margin-left: 8px;
      }
      .btn-edit,
      .btn-date {
        padding: 4px 8px;
        font-size: 11px;
        border-radius: 8px;
        border: 1px solid #cfd7f0;
        background: #f3f6ff;
        cursor: pointer;
      }
      .btn-delete {
        padding: 4px 8px;
        font-size: 11px;
        border-radius: 8px;
        border: none;
        background: #ff6b6b;
        color: white;
        cursor: pointer;
      }

      /* Summary */
      .summary {
        margin-top: 16px;
        background: white;
        border-radius: 14px;
        padding: 10px 12px;
        text-align: center;
        font-size: 14px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);
      }

      /* Î©îÎ™® */
      .memo-box {
        margin-top: 16px;
        background: white;
        border-radius: 14px;
        padding: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);
      }
      .memo-title {
        font-size: 14px;
        font-weight: 600;
        color: #2e6eff;
        margin-bottom: 6px;
      }
      #memo-text {
        width: 100%;
        height: 140px;
        border-radius: 12px;
        border: 1px solid #d8def0;
        padding: 8px;
        background: #f7f9ff;
        font-size: 13px;
        resize: none;
      }

      /* Ï∫òÎ¶∞Îçî ÌéòÏù¥ÏßÄ */
      .calendar-card {
        max-width: 420px;
        margin: 40px auto 0;
        background: white;
        border-radius: 18px;
        padding: 20px;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
      }
      .calendar-title {
        text-align: center;
        font-size: 22px;
        font-weight: 700;
        color: #2e6eff;
        margin-bottom: 6px;
      }

      .month-control {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 18px;
        margin-bottom: 8px;
      }
      .month-btn {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background: #e8eeff;
        border: none;
        color: #2e6eff;
        cursor: pointer;
      }
      .month-label {
        font-size: 15px;
        font-weight: 600;
      }

      .weekdays,
      .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        text-align: center;
        gap: 6px;
        margin-top: 8px;
        font-size: 12px;
      }
      .day-cell {
        width: 38px;
        height: 38px;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        position: relative;
      }
      .day-cell.today {
        border: 2px solid #2e6eff;
        font-weight: 600;
      }
      .day-cell.selected {
        background: #2e6eff;
        color: white;
        box-shadow: 0 4px 12px rgba(46, 139, 255, 0.5);
      }

      .day-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        position: absolute;
        bottom: 4px;
        left: 50%;
        transform: translateX(-50%);
      }
      .day-dot.incomplete {
        background: #2e6eff;
      }
      .day-dot.complete {
        background: #76d47a;
      }

      #cal-memo {
        margin-top: 10px;
        width: 100%;
        height: 70px;
        border-radius: 12px;
        border: 1px solid #d8def0;
        padding: 8px;
        background: #f7f9ff;
        font-size: 13px;
      }

      .cal-selected-label {
        margin-top: 8px;
        font-size: 13px;
        color: #525d78;
      }
    </style>
  </head>

  <body>
    <!-- =========================
      PAGE 1 : TODO
========================= -->
    <section class="page active" id="page-todo">
      <div class="container">
        <div class="top-bar">
          <div class="title">To Do List</div>
          <div class="profile">
            <div class="profile-name" id="profile-name">Hello, User</div>
            <div class="profile-img" id="profile-img-box">
              <img
                id="profile-img"
                src="https://images.pexels.com/photos/614810/pexels-photo-614810.jpeg?auto=compress&cs=tinysrgb&w=200"
              />
            </div>
          </div>
        </div>

        <!-- ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú input (Ïà®ÍπÄ) -->
        <input
          type="file"
          id="profile-upload"
          accept="image/*"
          style="display: none"
        />

        <!-- Ï£ºÍ∞Ñ Ï∫òÎ¶∞Îçî -->
        <div class="week-wrapper">
          <div class="week-label">This Week</div>
          <div class="week-days" id="week-days"></div>
        </div>

        <!-- ÏûÖÎ†• Ïπ¥Îìú -->
        <div class="todo-input-card">
          <div class="todo-row">
            <input
              id="todo-input"
              type="text"
              placeholder="Ìï† ÏùºÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
            />
            <button class="btn-primary" id="add-btn">Ï∂îÍ∞Ä</button>
          </div>

          <div class="filter-row">
            <button class="filter-btn active" data-filter="all">Ï†ÑÏ≤¥</button>
            <button class="filter-btn" data-filter="active">ÎØ∏ÏôÑÎ£å</button>
            <button class="filter-btn" data-filter="completed">ÏôÑÎ£å</button>
          </div>
        </div>

        <ul id="todo-list"></ul>

        <div class="summary">
          Ï¥ù <span id="sum-total">0</span>Í∞ú / ÏôÑÎ£å
          <span id="sum-complete">0</span>Í∞ú / ÎÇ®ÏùÄ
          <span id="sum-left">0</span>Í∞ú
        </div>

        <!-- Î©îÎ™® -->
        <div class="memo-box">
          <div class="memo-title">MEMO</div>
          <textarea id="memo-text" placeholder="Î©îÎ™®Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî"></textarea>
        </div>
      </div>

      <!-- Îã¨Î†• ÌéòÏù¥ÏßÄ Ïù¥Îèô -->
      <button class="page-arrow" id="btn-to-calendar">üìÖ</button>
    </section>

    <!-- =========================
      PAGE 2 : CALENDAR
========================= -->
    <section class="page" id="page-calendar">
      <div class="container">
        <div class="top-bar">
          <div class="title">Calendar</div>
        </div>

        <div class="calendar-card">
          <div class="calendar-title">Monthly View</div>

          <div class="month-control">
            <button class="month-btn" id="prev-month">‚Äπ</button>
            <div class="month-label" id="month-label"></div>
            <button class="month-btn" id="next-month">‚Ä∫</button>
          </div>

          <div class="weekdays">
            <div>Mon</div>
            <div>Tue</div>
            <div>Wed</div>
            <div>Thu</div>
            <div>Fri</div>
            <div>Sat</div>
            <div>Sun</div>
          </div>

          <div class="calendar-grid" id="calendar-grid"></div>

          <div class="cal-selected-label" id="cal-selected-label">
            ÎÇ†ÏßúÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî
          </div>
          <textarea id="cal-memo" disabled></textarea>
        </div>
      </div>

      <button class="page-arrow" id="btn-to-todo">‚¨Ö</button>
    </section>

    <script>
      /* ======================================
    ÌéòÏù¥ÏßÄ Ï†ÑÌôò
====================================== */
      const pageTodo = document.getElementById("page-todo");
      const pageCalendar = document.getElementById("page-calendar");

      document.getElementById("btn-to-calendar").onclick = () => {
        pageTodo.classList.remove("active");
        pageCalendar.classList.add("active");
        renderCalendar();
      };

      document.getElementById("btn-to-todo").onclick = () => {
        pageCalendar.classList.remove("active");
        pageTodo.classList.add("active");
        renderWeek();
      };

      /* ======================================
    Ï†ÄÏû• ÌÇ§
====================================== */
      const TODO_KEY = "modern_todos_v1";
      const MEMO_KEY = "modern_memo_v1";
      const PROFILE_KEY = "modern_profile_img_v1";
      const PROFILE_NAME_KEY = "modern_profile_name_v1";
      const CAL_MEMO_KEY = "modern_calendar_memo_";

      let todos = [];
      let filter = "all";
      let dragSourceId = null;

      /* ======================================
    DOM ÏöîÏÜå
====================================== */
      const todoInput = document.getElementById("todo-input");
      const addBtn = document.getElementById("add-btn");
      const todoListEl = document.getElementById("todo-list");
      const filterBtns = document.querySelectorAll(".filter-btn");
      const memoEl = document.getElementById("memo-text");

      const profileImgBox = document.getElementById("profile-img-box");
      const profileImg = document.getElementById("profile-img");
      const profileUpload = document.getElementById("profile-upload");

      const profileNameEl = document.getElementById("profile-name");

      const today = new Date();
      const todayStr = formatYMD(today);

      /* ======================================
    Ïú†Ìã∏ Ìï®Ïàò
====================================== */
      function formatYMD(date) {
        const y = date.getFullYear();
        const m = String(date.getMonth() + 1).padStart(2, "0");
        const d = String(date.getDate()).padStart(2, "0");
        return `${y}-${m}-${d}`;
      }

      /* ======================================
      Îç∞Ïù¥ÌÑ∞ Î°úÎìú & Ï†ÄÏû•
====================================== */
      function loadData() {
        const t = localStorage.getItem(TODO_KEY);
        if (t) todos = JSON.parse(t);

        const m = localStorage.getItem(MEMO_KEY);
        if (m) memoEl.value = m;
      }

      function saveData() {
        localStorage.setItem(TODO_KEY, JSON.stringify(todos));
      }

      memoEl.oninput = () => {
        localStorage.setItem(MEMO_KEY, memoEl.value);
      };

      /* ======================================
    ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú
====================================== */
      function loadProfileImg() {
        const saved = localStorage.getItem(PROFILE_KEY);
        if (saved) {
          profileImg.src = saved;
        }
      }
      profileImgBox.onclick = () => profileUpload.click();
      profileUpload.onchange = function () {
        const file = this.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
          const data = e.target.result;
          profileImg.src = data;
          localStorage.setItem(PROFILE_KEY, data);
        };
        reader.readAsDataURL(file);
      };

      /* ======================================
    ÌîÑÎ°úÌïÑ Ïù¥Î¶Ñ Î≥ÄÍ≤Ω Í∏∞Îä•
====================================== */
      function loadProfileName() {
        const name = localStorage.getItem(PROFILE_NAME_KEY);
        if (name) profileNameEl.textContent = name;
      }

      profileNameEl.onclick = () => {
        const current = profileNameEl.textContent.replace("Hello, ", "");
        const newName = prompt("Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî", current);

        if (newName && newName.trim() !== "") {
          const final = `Hello, ${newName.trim()}`;
          profileNameEl.textContent = final;
          localStorage.setItem(PROFILE_NAME_KEY, final);
        }
      };

      /* ======================================
    ToDo Í∏∞Îä•
====================================== */
      function addTodo() {
        const text = todoInput.value.trim();
        if (!text) return;

        const newTodo = {
          id: Date.now(),
          text,
          completed: false,
          date: null,
          order: todos.length
            ? Math.max(...todos.map((t) => t.order || 0)) + 1
            : 0,
        };

        todos.push(newTodo);
        todoInput.value = "";
        saveData();
        renderTodos(newTodo.id);
        renderWeek();
        renderCalendar();
      }

      addBtn.onclick = addTodo;
      todoInput.onkeydown = (e) => {
        if (e.key === "Enter") addTodo();
      };

      function toggleTodo(id) {
        todos = todos.map((t) =>
          t.id === id ? { ...t, completed: !t.completed } : t
        );
        saveData();
        renderTodos(id);
        renderWeek();
        renderCalendar();
      }

      function updateSummary() {
        const total = todos.length;
        const comp = todos.filter((t) => t.completed).length;

        document.getElementById("sum-total").textContent = total;
        document.getElementById("sum-complete").textContent = comp;
        document.getElementById("sum-left").textContent = total - comp;
      }

      function renderTodos(highlightId = null) {
        todoListEl.innerHTML = "";

        todos.sort((a, b) => a.order - b.order);

        let filtered = todos;
        if (filter === "active") filtered = todos.filter((t) => !t.completed);
        if (filter === "completed") filtered = todos.filter((t) => t.completed);

        filtered.forEach((todo) => {
          const li = document.createElement("li");
          li.className = "todo-item";
          if (todo.completed) li.classList.add("completed");

          /* ÎìúÎûòÍ∑∏ Í∏∞Îä• */
          li.draggable = true;
          li.dataset.id = todo.id;

          li.addEventListener("dragstart", (e) => {
            dragSourceId = todo.id;
            e.dataTransfer.effectAllowed = "move";
          });
          li.addEventListener("dragover", (e) => {
            e.preventDefault();
            li.classList.add("drag-over");
          });
          li.addEventListener("dragleave", () => {
            li.classList.remove("drag-over");
          });
          li.addEventListener("drop", () => {
            li.classList.remove("drag-over");
            reorderTodos(dragSourceId, todo.id);
          });

          /* ÌïòÏù¥ÎùºÏù¥Ìä∏ */
          if (todo.id === highlightId) {
            li.classList.add("highlight");
            setTimeout(() => li.classList.remove("highlight"), 600);
          }

          const check = document.createElement("div");
          check.className = "check";
          check.onclick = () => toggleTodo(todo.id);

          const text = document.createElement("div");
          text.className = "todo-text";
          text.textContent = todo.text;

          const actions = document.createElement("div");
          actions.className = "actions";

          const dateBtn = document.createElement("button");
          dateBtn.className = "btn-date";
          dateBtn.textContent = todo.date || "ÎÇ†Ïßú";
          const dateInput = document.createElement("input");
          dateInput.type = "date";
          dateInput.style.display = "none";
          if (todo.date) dateInput.value = todo.date;

          dateBtn.onclick = () =>
            dateInput.showPicker ? dateInput.showPicker() : dateInput.click();

          dateInput.onchange = () => {
            todo.date = dateInput.value || null;
            dateBtn.textContent = todo.date || "ÎÇ†Ïßú";
            saveData();
            renderWeek();
            renderCalendar();
          };

          const editBtn = document.createElement("button");
          editBtn.className = "btn-edit";
          editBtn.textContent = "ÏàòÏ†ï";
          editBtn.onclick = () => {
            const changed = prompt("ÏàòÏ†ïÌï† ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî", todo.text);
            if (changed !== null) {
              todo.text = changed.trim();
              saveData();
              renderTodos(todo.id);
            }
          };

          const delBtn = document.createElement("button");
          delBtn.className = "btn-delete";
          delBtn.textContent = "ÏÇ≠Ï†ú";
          delBtn.onclick = () => {
            todos = todos.filter((t) => t.id !== todo.id);
            saveData();
            renderTodos();
            renderWeek();
            renderCalendar();
          };

          actions.append(dateBtn, dateInput, editBtn, delBtn);
          li.append(check, text, actions);
          todoListEl.appendChild(li);
        });

        updateSummary();
      }

      function reorderTodos(sourceId, targetId) {
        if (!sourceId || !targetId || sourceId === targetId) return;
        let from = todos.findIndex((t) => t.id === sourceId);
        let to = todos.findIndex((t) => t.id === targetId);
        const [moved] = todos.splice(from, 1);
        todos.splice(to, 0, moved);

        todos = todos.map((t, i) => ({ ...t, order: i }));
        saveData();
        renderTodos();
      }

      /* ======================================
    ÌïÑÌÑ∞
====================================== */
      filterBtns.forEach((btn) => {
        btn.onclick = () => {
          filterBtns.forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");
          filter = btn.dataset.filter;
          renderTodos();
        };
      });

      /* ======================================
    Ï£ºÍ∞Ñ Ï∫òÎ¶∞Îçî
====================================== */
      const weekDaysEl = document.getElementById("week-days");

      function getMonday(d) {
        const date = new Date(d);
        const day = (date.getDay() + 6) % 7;
        date.setDate(date.getDate() - day);
        return date;
      }

      function renderWeek() {
        weekDaysEl.innerHTML = "";
        const monday = getMonday(today);

        for (let i = 0; i < 7; i++) {
          const d = new Date(monday);
          d.setDate(monday.getDate() + i);
          const ymd = formatYMD(d);

          const box = document.createElement("div");
          box.className = "week-day";

          const dayNames = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"];
          const nameEl = document.createElement("span");
          nameEl.textContent = dayNames[i];
          const dateEl = document.createElement("span");
          dateEl.className = "date";
          dateEl.textContent = d.getDate();

          if (ymd === todayStr) box.classList.add("today");

          if (todos.some((t) => t.date === ymd)) {
            const dot = document.createElement("div");
            dot.className = "week-dot";
            box.appendChild(dot);
          }

          box.append(nameEl, dateEl);
          weekDaysEl.appendChild(box);
        }
      }

      /* ======================================
    ÏõîÍ∞Ñ Ï∫òÎ¶∞Îçî
====================================== */
      const monthLabelEl = document.getElementById("month-label");
      const calGridEl = document.getElementById("calendar-grid");
      const calMemoEl = document.getElementById("cal-memo");
      const calSelectedLabel = document.getElementById("cal-selected-label");

      let calYear = today.getFullYear();
      let calMonth = today.getMonth();
      let selectedYMD = null;

      function calMemoKey(ymd) {
        return CAL_MEMO_KEY + ymd;
      }

      function renderCalendar() {
        calGridEl.innerHTML = "";

        const first = new Date(calYear, calMonth, 1);
        const last = new Date(calYear, calMonth + 1, 0).getDate();
        const start = (first.getDay() + 6) % 7;

        const monthName = first
          .toLocaleString("default", { month: "long" })
          .toUpperCase();
        monthLabelEl.textContent = `${monthName} ${calYear}`;

        for (let i = 0; i < start; i++) {
          calGridEl.appendChild(document.createElement("div"));
        }

        for (let d = 1; d <= last; d++) {
          const cell = document.createElement("div");
          cell.className = "day-cell";
          cell.textContent = d;

          const dateObj = new Date(calYear, calMonth, d);
          const ymd = formatYMD(dateObj);

          if (ymd === todayStr) cell.classList.add("today");
          if (ymd === selectedYMD) cell.classList.add("selected");

          const dayTodos = todos.filter((t) => t.date === ymd);

          if (dayTodos.length > 0) {
            const dot = document.createElement("div");
            dot.className = "day-dot";
            dot.classList.add(
              dayTodos.some((t) => !t.completed) ? "incomplete" : "complete"
            );
            cell.appendChild(dot);
          }

          cell.onclick = () => {
            selectedYMD = ymd;
            renderCalendar();
            loadCalMemo();
          };

          calGridEl.appendChild(cell);
        }
      }

      function loadCalMemo() {
        if (!selectedYMD) {
          calMemoEl.disabled = true;
          calMemoEl.value = "";
          calSelectedLabel.textContent = "ÎÇ†ÏßúÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî";
          return;
        }

        calMemoEl.disabled = false;
        calSelectedLabel.textContent = selectedYMD + " Î©îÎ™®";
        const m = localStorage.getItem(calMemoKey(selectedYMD));
        calMemoEl.value = m || "";
      }

      calMemoEl.oninput = () => {
        if (!selectedYMD) return;
        localStorage.setItem(calMemoKey(selectedYMD), calMemoEl.value);
      };

      /* Ïõî Ïù¥Îèô */
      document.getElementById("prev-month").onclick = () => {
        calMonth--;
        if (calMonth < 0) {
          calMonth = 11;
          calYear--;
        }
        renderCalendar();
      };

      document.getElementById("next-month").onclick = () => {
        calMonth++;
        if (calMonth > 11) {
          calMonth = 0;
          calYear++;
        }
        renderCalendar();
      };

      /* ======================================
    Ï¥àÍ∏∞ Ïã§Ìñâ
====================================== */
      loadData();
      loadProfileImg();
      loadProfileName();
      renderTodos();
      renderWeek();
      renderCalendar();
    </script>
  </body>
</html>
